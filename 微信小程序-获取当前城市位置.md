 # 微信小程序-获取当前城市位置 #

   1， 获取当前地理位置，首先要拿到用户的授权wx.openSetting；

   2，微信的getLocation接口，获取当前用户的地理位置（微信返回的是经纬度，速度等参数）；

   3，微信没有将经纬度直接转换为地理位置，借用腾讯位置服务中关于微信小程序的地理转换JS SDK 的API（返回信息中包括国家，省，市，区，经纬度等地理位置）

步骤描述清楚以后，下面就开始按步骤操作了；（本文仅仅讲述如何获取用户地理位置的授权）

图示为获取用户地理位置授权弹窗

在用户首次进入某页面（需要地理位置授权）时候，在页面进行onLoad，onShow时候，进行调用wx.getLocation要求用户进行授权；以后每次进入该页面时，通过wx.getSetting接口，返回用户授权具体信息。

wx.getSetting接口具体API地址链接为点击打开链接

scope.userLocation就是地理授权的标志；

当该标志是underfind，表示用户初次进入该页面，当该标志是false，表示用户初次进入该页面拒绝了地理授权，应进行重新要求获取授权。

在拿到用户授权以后，使用微信的API获取当前位置的经纬度微信获取位置API
这里，我们进行使用的是腾讯位置服务；专为小程序开发者提供LBS数据服务工具包，可以在小程序中调用腾讯位置服务的POI检索、关键词输入提示、地址解析、逆地址解析、行政区划和距离计算等数据。

   1，得到开发者秘钥

   2，下载微信小程序javaScriptSDK，

   3，安全域名设置，在“设置” -> “开发设置”中设置request合法域名，添加http://api.map.qq.com

在文件中引入对应的javaScriptSDK文件

在文件中进行js调用

最后的结果就是可以获得自己所在城市的具体位置了

index.js部分的代码

页面展示部分的代码

链接：https://blog.csdn.net/weixin_42262436/article/details/80458430
